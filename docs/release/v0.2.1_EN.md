# Release v0.2.1

**Release Date**: 2025-12-07

## Overview

v0.2.1 is an important feature enhancement release, adding the `--dry-run` command for IDE integration validation, enumgen support for string underlying types, validategen implementation of the `ValidatableTool` interface for static validation, and VSCode extension improvements for diagnostics and type parsing.

## New Features

### devgen: `--dry-run` Command

Added `--dry-run` and `--json` flags for validating annotations without writing files:

```bash
devgen --dry-run ./...              # validate and preview
devgen --dry-run --json ./...       # JSON format output for IDE integration
```

**Output Format**:
```json
{
  "success": false,
  "diagnostics": [
    {
      "severity": "error",
      "message": "@method annotation can only be applied to custom types",
      "file": "examples.go",
      "line": 153,
      "column": 2,
      "tool": "validategen",
      "code": "E009"
    }
  ],
  "stats": {
    "packagesLoaded": 1,
    "filesGenerated": 0,
    "errorCount": 1,
    "warningCount": 0
  }
}
```

### enumgen: String Underlying Type Support

enumgen now supports `string` as an underlying type:

```go
// enumgen:@enum(string)
type Color string

const (
    ColorRed   Color = "red"
    ColorGreen Color = "green"
    ColorBlue  Color = "blue"
)
```

**Generated Methods**:
- `IsValid()` - check if value is valid
- `String()` - return string representation
- `List()` - return all valid values
- `Contains(string)` - check if string is a valid value
- `Parse(string)` - parse string to enum value

**Note**: String type enums do not generate `Name()`, `Names()`, `ContainsName()` methods, and `@name` annotation is not supported.

**Supported Underlying Types**:
- Integer types: `int`, `int8`, `int16`, `int32`, `int64`, `uint`, `uint8`, `uint16`, `uint32`, `uint64`
- String type: `string`

### enumgen: ValidatableTool Interface

enumgen implements `ValidatableTool` interface for static validation:

| Error Code | Description |
|------------|-------------|
| E001 | Unsupported underlying type |
| E002 | @name annotation not supported for string types |
| E003 | Duplicate enum name |
| E004 | @name annotation missing parameter |

### validategen: ValidatableTool Interface

validategen implements `ValidatableTool` interface for comprehensive static validation:

- **Parameter validation**: Check if all annotation parameters exist and are properly formatted
- **Parameter type checking**: Numeric parameters must be valid numbers
- **Field type checking**: Use `UnderlyingType` to validate annotation compatibility with field types
- **@method validation**: Check if target type is a custom type

| Error Code | Description |
|------------|-------------|
| E001 | @oneof missing values |
| E002 | @format missing format parameter |
| E003 | Unsupported @format format |
| E004 | @regex missing pattern parameter |
| E005 | Invalid regular expression |
| E006 | Annotation missing required parameter |
| E007 | Invalid parameter value (e.g., numeric parameter is not a number) |
| E008 | Field type does not support this annotation |
| E009 | @method can only be applied to custom types |

### genkit: New Types and APIs

- **`ValidatableTool` interface**: Tools can implement this for static validation
- **`DiagnosticCollector`**: Fluent API for collecting diagnostics
- **`DryRunResult`**: Dry-run result struct
- **`Diagnostic`**: Diagnostic struct with severity, message, file, line, column, tool, code
- **`Field.UnderlyingType`**: Field's underlying type (for custom types like `type Email string`)
- **`Enum.UnderlyingType`**: Enum's underlying type

### VSCode Extension Improvements

#### Dry-run Validation Integration

- Added `devgen.validate` command for manual validation trigger
- Added `devgen.validateOnSave` configuration option (default `true`)
- Automatically runs `devgen --dry-run --json` validation on Go file save and open
- Validation results displayed in Problems panel

#### Enhanced Field Type Parsing

Fixed complex type parsing, now correctly supports:
- `[]Address` - slice types
- `[]*Address` - pointer slices
- `map[string]Address` - map types
- `map[string]*Address` - pointer value maps

#### Diagnostics Cleanup Fix

Fixed issue where old diagnostic errors were not cleared after saving files.

#### Installation Logic Optimization

Check if devgen exists before auto-installing to avoid overwriting local development builds.

#### Plugin Version Compatibility

Detect genkit package modification time and automatically clean expired plugin cache to resolve plugin version mismatch issues.

## Bug Fixes

- Fixed `devgen --dry-run --json` output being polluted by logs (emoji and ANSI color codes)
- Fixed `[]Address` being incorrectly identified as `map` type in VSCode extension
- Fixed dry-run diagnostics not clearing after errors are fixed
- Fixed infinite retry installation loop when plugin version mismatch occurs

## Upgrade Guide

### Upgrading from v0.2.0

1. **Reinstall devgen**:
   ```bash
   go install github.com/tlipoca9/devgen/cmd/devgen@v0.2.1
   ```

2. **VSCode Extension**: Update to the latest version

3. **Regenerate code**: If using enumgen string type enums, re-run `devgen`
