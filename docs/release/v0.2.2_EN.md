# Release v0.2.2

**Release Date**: 2025-12-08

## Overview

v0.2.2 is a feature enhancement release. validategen adds duration validation annotations, supports pointer numeric types for comparison validations, and moves `@method` annotation validation logic from VSCode plugin to CLI tool.

## New Features

### validategen: Duration Validation Annotations

Added three annotations for validating `time.Duration` strings:

#### `@duration` - Format Validation

Validates string is a valid Go duration format (e.g., `1h30m`, `500ms`):

```go
// validategen:@validate
type Config struct {
    // validategen:@duration
    Timeout string  // Must be a valid duration format
}
```

#### `@duration_min(duration)` - Minimum Value Validation

Validates duration string value is not less than specified value:

```go
// validategen:@validate
type Config struct {
    // validategen:@duration_min(1s)
    Timeout string  // Timeout at least 1 second

    // validategen:@duration_min(100ms)
    RetryInterval string  // Retry interval at least 100 milliseconds
}
```

#### `@duration_max(duration)` - Maximum Value Validation

Validates duration string value is not greater than specified value:

```go
// validategen:@validate
type Config struct {
    // validategen:@duration_max(1h)
    Timeout string  // Timeout at most 1 hour

    // validategen:@duration_max(30s)
    RetryInterval string  // Retry interval at most 30 seconds
}
```

#### Combined Usage

The three annotations can be combined. Generated code merges into a single block, parsing only once:

```go
// validategen:@validate
type Config struct {
    // validategen:@duration
    // validategen:@duration_min(1s)
    // validategen:@duration_max(1h)
    RetryInterval string  // Valid duration, range 1s ~ 1h
}
```

**Generated Code** (optimized):
```go
if x.RetryInterval != "" {
    if _dur, _err := time.ParseDuration(x.RetryInterval); _err != nil {
        errs = append(errs, fmt.Sprintf("RetryInterval must be a valid duration..."))
    } else {
        if _dur < 1000000000 {
            errs = append(errs, fmt.Sprintf("RetryInterval must be at least 1s..."))
        }
        if _dur > 3600000000000 {
            errs = append(errs, fmt.Sprintf("RetryInterval must be at most 1h..."))
        }
    }
}
```

#### Performance Data

| Annotation | Mean (1000x) | Per-op |
|------------|--------------|--------|
| `@duration` (valid) | 25.45µs | 25.45ns |
| `@duration` (invalid) | 67.56µs | 67.56ns |
| `@duration_min` | 11.78µs | 11.78ns |
| `@duration_max` | ~11µs | ~11ns |
| Combined | ~11µs | ~11ns |

### validategen: Pointer Numeric Type Support

Comparison annotations like `@min`, `@max`, `@gt`, `@gte`, `@lt`, `@lte`, `@eq`, `@ne` now support pointer numeric types:

```go
// validategen:@validate
type Config struct {
    // validategen:@min(1)
    // validategen:@max(65535)
    Port *int  // Optional port, validates range when non-nil

    // validategen:@gte(0)
    Timeout *float64  // Optional timeout, validates >= 0 when non-nil
}
```

**Generated Code**:
```go
if x.Port != nil {
    if *x.Port < 1 {
        errs = append(errs, "Port must be at least 1...")
    }
    if *x.Port > 65535 {
        errs = append(errs, "Port must be at most 65535...")
    }
}
```

### validategen: `@method` Validation Moved to CLI

`@method` annotation parameter validation moved from VSCode plugin to CLI tool for more accurate compile-time checking:

- Validates method exists on target type
- Validates method signature is correct (no parameters, returns `error`)
- Provides clear error messages with location

| Error Code | Description |
|------------|-------------|
| E010 | Method does not exist |
| E011 | Method signature is incorrect |

## Documentation Updates

- README.md / README_EN.md added duration validation annotations documentation
- Updated annotation quick reference table
- Added duration benchmark results

## Upgrade Guide

### Upgrading from v0.2.1

Direct upgrade with no breaking changes:

```bash
go install github.com/tlipoca9/devgen/cmd/devgen@v0.2.2
```

If using duration validation, re-run `devgen` to generate code.
