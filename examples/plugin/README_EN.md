# DevGen Plugin Examples

[中文](README.md) | English

This directory contains examples of two plugin types to verify their behavioral consistency.

## Plugin Types

| Type | Directory | Description |
|------|-----------|-------------|
| `source` | `plugin-source/` | Go source code, compiled at runtime |
| `plugin` | `plugin-goplugin/` | Pre-compiled Go plugin (.so) |

## Quick Test

```bash
cd examples/plugin-test

# Test both types
./test-all.sh
```

## Step-by-Step Testing

### 1. Source Type (Runtime Compilation)

```bash
cd examples/plugin-test

# Use source configuration
cp devgen-source.toml devgen.toml

# Run (devgen will automatically compile plugin-source)
devgen ./testdata

# View generated file
cat testdata/testdata_marked.go
```

### 2. Go Plugin Type (.so)

> Note: Go plugin is only supported on Linux and macOS

```bash
cd examples/plugin-test

# First compile the .so file
go build -buildmode=plugin -o ../plugin-goplugin/goplugin.so ../plugin-goplugin

# Use plugin configuration
cp devgen-goplugin.toml devgen.toml

# Run
devgen ./testdata

# View generated file
cat testdata/testdata_marked.go
```

## Expected Output

Both types should generate the same structure in `testdata/testdata_marked.go`:

```go
// Code generated by xxx. DO NOT EDIT.

package testdata

var MarkedTypes = []string{
    "User",
    "Order",
}
```

The only difference is the plugin name in the comment.

## Creating Your Own Plugin

### Source Type (Recommended)

The simplest approach, no pre-compilation needed:

```go
// myplugin/myplugin.go
package main

import "github.com/tlipoca9/devgen/genkit"

type MyPlugin struct{}

func (m *MyPlugin) Name() string { return "myplugin" }

func (m *MyPlugin) Run(gen *genkit.Generator, log *genkit.Logger) error {
    // Your code generation logic
    return nil
}

var Tool genkit.Tool = &MyPlugin{}

func main() {}
```

Configuration in `devgen.toml`:

```toml
[[plugins]]
name = "myplugin"
path = "./myplugin"
type = "source"
```

### Go Plugin Type

Suitable for scenarios requiring maximum performance:

```bash
go build -buildmode=plugin -o myplugin.so ./myplugin
```

Configuration:

```toml
[[plugins]]
name = "myplugin"
path = "./myplugin.so"
type = "plugin"
```
