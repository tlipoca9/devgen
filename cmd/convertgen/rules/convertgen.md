# convertgen - Struct Converter Generator

convertgen 是一个 Go 代码生成工具，用于生成类型安全的结构体转换代码。

## 使用方式

### 1. 定义转换器接口

使用 `@converter` 注解标记接口：

```go
// convertgen:@converter
type UserConverter interface {
    Convert(src *User) *UserDTO
    ConvertList(src []*User) []*UserDTO
}
```

### 2. 字段映射

使用 `@map(src, dst)` 注解映射不同名称的字段：

```go
// convertgen:@converter
type UserConverter interface {
    // convertgen:@map(FullName, Name)
    // convertgen:@map(EmailAddress, Email)
    Convert(src *User) *UserDTO
}
```

### 3. 忽略字段

使用 `@ignore(field)` 注解忽略特定字段：

```go
// convertgen:@converter
type UserConverter interface {
    // convertgen:@ignore(Password)
    // convertgen:@ignore(InternalID)
    Convert(src *User) *UserDTO
}
```

### 4. 浅拷贝

默认使用深拷贝，使用 `@shallow` 注解切换为浅拷贝：

```go
// convertgen:@converter
type UserConverter interface {
    // convertgen:@shallow
    Convert(src *User) *UserDTO
}
```

### 5. 嵌套类型转换

当 Converter 接口中定义了多个转换方法时，convertgen 会自动在嵌套字段转换中调用对应的方法：

```go
// convertgen:@converter
type UserConverter interface {
    // 定义 Address 转换方法
    ConvertAddress(src *Address) *AddressDTO
    
    // Convert 方法会自动调用 ConvertAddress 转换 Address 字段
    Convert(src *User) *UserDTO
    
    // ConvertList 会自动调用 Convert 转换每个元素
    ConvertList(src []*User) []*UserDTO
}
```

## 生成代码示例

输入：

```go
type User struct {
    ID       int
    FullName string
    Password string
    Address  *Address
}

type UserDTO struct {
    ID      int
    Name    string
    Address *AddressDTO
}

type Address struct {
    Street string
    City   string
}

type AddressDTO struct {
    Street string
    City   string
}

// convertgen:@converter
type UserConverter interface {
    ConvertAddress(src *Address) *AddressDTO
    // convertgen:@map(FullName, Name)
    // convertgen:@ignore(Password)
    Convert(src *User) *UserDTO
}
```

生成：

```go
// Code generated by convertgen. DO NOT EDIT.

package example

type userConverterImpl struct{}

var DefaultUserConverter = &userConverterImpl{}

var _ UserConverter = (*userConverterImpl)(nil)

func (c *userConverterImpl) ConvertAddress(src *Address) *AddressDTO {
    if src == nil {
        return nil
    }
    dst := &AddressDTO{}
    dst.Street = src.Street
    dst.City = src.City
    return dst
}

func (c *userConverterImpl) Convert(src *User) *UserDTO {
    if src == nil {
        return nil
    }
    dst := &UserDTO{}
    dst.ID = src.ID
    dst.Name = src.FullName
    dst.Address = c.ConvertAddress(src.Address)  // 自动调用 ConvertAddress
    return dst
}
```

## 注解参考

| 注解 | 级别 | 说明 | 示例 |
|------|------|------|------|
| `@converter` | 接口 | 标记为转换器接口 | `// convertgen:@converter` |
| `@map(src, dst)` | 方法 | 字段映射 | `// convertgen:@map(FullName, Name)` |
| `@ignore(field)` | 方法 | 忽略字段 | `// convertgen:@ignore(Password)` |
| `@shallow` | 方法 | 使用浅拷贝 | `// convertgen:@shallow` |

## 方法签名要求

- 必须有且仅有 1 个参数（源类型）
- 必须有且仅有 1 个返回值（目标类型）
- 支持指针类型和切片类型
